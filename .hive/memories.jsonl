{"id":"mem-014b3aa446997679","information":"In api_server.py, new Flask route endpoints should follow the existing pattern: (1) Call the appropriate management class method (event_mgmt, user_mgmt, family_mgmt), (2) Return format_response(result) which handles the response formatting automatically. The format_response helper extracts nested \"data\" fields and handles errors with appropriate HTTP status codes.","created_at":"2026-01-02T12:34:34.071Z","tags":"api_server,flask,endpoint-pattern,shabbat-mcp-server"}
{"id":"mem-050ae7d3bfa324f0","information":"When creating Konva-based overlay components for canvas in React: (1) Use react-konva components (Image, Group, Rect) not HTML elements, (2) Load images asynchronously using new Image() and set state when onload fires, (3) Use Group to wrap multiple Konva elements together, (4) Set listening={false} on all overlay elements to prevent mouse interaction, (5) For HTML content like labels with icons, create a separate HTML component that positions absolutely over the canvas (Konva can't easily render HTML). Pattern: Konva overlay for visual effects, HTML overlay for text/icons.","created_at":"2026-01-03T23:54:57.845Z","tags":"react,konva,canvas,overlay,react-konva,image-markup"}
{"id":"mem-18e922c00cd30a05","information":"Fixed invitation endpoints in api_server.py: (1) POST /api/invitations/bulk already existed and worked correctly. (2) POST /api/invitations/<id>/rsvp already existed but had duplicate logic - refactored to use event_mgmt.update_rsvp(). (3) POST /api/invitations/<id>/respond was calling non-existent event_mgmt.respond_to_invitation - fixed to call update_rsvp(). Key insight: API endpoints should delegate to management classes, not duplicate database access logic.","created_at":"2026-01-02T12:37:20.633Z","tags":"api-server,invitation-endpoints,refactoring,shabbat-server"}
{"id":"mem-25d0f611dc56d777","information":"Unskipped 4 invitation tests by fixing their skip reasons. Tests were skipped claiming endpoints didn't exist, but they did exist. Fixed test mocks: (1) send_invitation returns {\"status\": \"Success\", \"data\": {\"invitation_id\": ...}} not with \"invitation\" wrapper. (2) test_update_rsvp needed mock_db fixture for dietary notes update. Pattern: Always verify skip reasons before unskipping - they may be outdated.","created_at":"2026-01-02T12:37:26.908Z","tags":"testing,pytest,skip-markers,test-fixtures,shabbat-server"}
{"id":"mem-2931a30813ad0d4e","information":"When removing pytest.mark.skip decorators from test files, be careful with line-based editing tools like sed. If multiple decorators need to be removed, line numbers shift after each deletion. Better to use the Edit tool or carefully track line number changes. The test file structure has def test_X(self, client, mock_Y) where mock_Y fixtures are defined at the class level.","created_at":"2026-01-02T12:34:40.819Z","tags":"pytest,testing,skip-decorator,sed,shabbat-mcp-server"}
{"id":"mem-2d652a266d9e09bb","information":"When running pytest with langsmith plugin compatibility issues (ForwardRef._evaluate error), use: PYTEST_DISABLE_PLUGIN_AUTOLOAD=1 python3 -m pytest <test> -p no:langsmith. This disables problematic plugins while still running tests.","created_at":"2026-01-02T12:37:32.435Z","tags":"pytest,langsmith,debugging,test-environment"}
{"id":"mem-2f72e66587814530","information":"The shabbat-mcp-server project has two similar server implementations: api_server.py (Flask REST API) and fastmcp_server.py (MCP server). They both need initialize_admin() functions but with different implementations - api_server uses direct database calls via user_mgmt, while fastmcp_server uses REST API requests. When fixing tests, check which server module is being tested.","created_at":"2026-01-02T11:02:09.163Z","tags":"architecture,shabbat-mcp-server,api_server,fastmcp_server"}
{"id":"mem-392162e0f7d35677","information":"When adding state to track overlay images in React contexts for AI progress tracking: (1) Add new fields to both the state interface and initial state constant to avoid type errors, (2) Export new action types from the context interface, (3) Implement setter callbacks with useCallback for performance, (4) Consider automatic state transitions based on step changes (e.g., when iterationImage arrives in event, automatically set it as thinkingImage with 'thinking' status; when step changes from 'processing' to 'self_checking', mark as 'accepted'), (5) Let consuming components handle cleanup timing after animations complete rather than eagerly clearing state.","created_at":"2026-01-03T23:54:45.579Z","tags":"react,context,state-management,ai-progress,overlay,type-safety"}
{"id":"mem-42385cf47d82f34f","information":"Flask's format_response helper extracts nested \"data\" fields from management class responses. Management classes return {\"status\": \"Success\", \"data\": {...}}, but format_response extracts just the {...} part. Tests should assert on the flattened response, not expect result[\"data\"][\"field\"].","created_at":"2026-01-02T11:07:59.277Z","tags":"flask,api-testing,shabbat-server,response-format"}
{"id":"mem-42bb0aefd0f6d346","information":"When moving tests to tests/integration/ directory, remove the sys.path.insert() manipulation at the top of the test file. The pytest conftest.py in tests/ directory automatically provides the correct path setup for subdirectories.","created_at":"2026-01-02T11:02:11.279Z","tags":"pytest,testing,directory-structure,integration-tests"}
{"id":"mem-53812dff11e08ba4","information":"When fixing API mismatches between test files and implementation, check for backward compatibility issues. In this case, api_server.py used old parameter names (invitee_email, invited_by_email) while EventManagement.send_invitation() was refactored to use new names (user_id, invited_by). Solution: Add backward compatibility using **kwargs to accept both old and new parameter names, mapping emails to user_ids internally.","created_at":"2026-01-02T11:07:53.593Z","tags":"api-compatibility,refactoring,testing,shabbat-server"}
{"id":"mem-58100c9581d3a85b","information":"Apple Intelligence-style gradient border implementation: Use @property CSS custom property for --gradient-angle, apply conic-gradient with colors from var(--gradient-angle), animate with @keyframes that changes --gradient-angle from 0deg to 360deg. Create border effect with padding on container and ::before pseudo-element with inset matching padding to mask inner area. Position absolutely over canvas with pointer-events: none. Different states (thinking/accepted/rejected) use different gradient colors and animations.","created_at":"2026-01-04T00:11:32.689Z","tags":"css,animation,gradient,conic-gradient,@property,apple-intelligence,border-effect,ui-polish"}
{"id":"mem-6ca6dac07b6ce2d9","information":"Successfully moved 14 integration test files from tests/ to tests/integration/: test_rest_api_comprehensive.py, test_invitations_api.py, test_rsvp_security.py, test_dietary_restrictions.py, test_helicone_session_tracking.py, test_family_ui_integration.py, test_deletion_endpoints.py, test_invite_guest.py, test_list_events.py, test_missing_endpoints.py, test_user_context_injection.py, test_users_without_email.py, test_wildcard_search.py, test_hermetic_eval.py. Removed sys.path.insert() manipulations from 10 files that had them. All 113 tests in these files are now collected correctly by pytest in their new location.","created_at":"2026-01-02T11:23:00.060Z","tags":"pytest,testing,integration-tests,file-organization,refactoring"}
{"id":"mem-7a52ac419c1a83ad","information":"When fixing import errors in test files: 1) Check if the function exists elsewhere in the codebase (use grep), 2) If the function exists in a similar module (like fastmcp_server.py vs api_server.py), replicate it in the target module to maintain consistency, 3) Add both the function AND any related global variables it uses (like admin_user_id), 4) Update the main() function's global declarations if needed.","created_at":"2026-01-02T11:02:05.846Z","tags":"testing,imports,python,api_server"}
{"id":"mem-87f31385286bc04f","information":"Successfully consolidated user management tests from tests/test_user_management.py and tests/test_user_management_comprehensive.py into tests/unit/test_user_management.py. The comprehensive version had better organization with test classes (TestUserCreation, TestUserRetrieval, TestUserRoleManagement, TestUserUpdate, TestUserPreferences, TestEdgeCases, TestDataIntegrity), so it was used as the base. Added unique tests from the basic file including test_find_user_multiple_results and test_store_preference_duplicate_not_added_twice. Final file has 41 tests, all passing. The conftest.py at tests/ level automatically provides fixtures to tests/unit/ subdirectory.","created_at":"2026-01-02T11:15:25.169Z","tags":"testing,pytest,consolidation,user-management,test-organization"}
{"id":"mem-9fd051eba1db5e8e","information":"Fixed 8 failing tests in test_clean_api_endpoints.py. Root causes: 1) MockDatabase missing methods (find_users, get_all_users, get_events_by_host, get_user_invitations, get_event_invitations, get_all_invitations, get_families_for_user, create_family_connection), 2) MockDatabase.create_user signature mismatch (needed contact_info param), 3) FastAPI route order issue (/api/users/{user_id} matched before /api/users/search), 4) MockDatabase.update_event not actually updating, 5) Test isolation issue (shared MockDatabase across tests), 6) Invalid role names (\"participant\" vs \"Guest\"), 7) TestClient.get() doesn't accept json parameter, 8) Pagination implementation using wrong slice order. Solution: Added all missing methods to MockDatabase, fixed create_user signature, reordered routes (specific before generic), implemented actual update in update_event, added fixture to reset database between tests, fixed role names, removed json param from GET, and test expectation for message field (clean_api doesn't return it).","created_at":"2026-01-02T11:56:25.596Z","tags":"testing,fastapi,mock-database,test-isolation,pytest,route-ordering"}
{"id":"mem-a574a35769a2a59e","information":"When consolidating duplicate test files in pytest, prefer the version that uses shared conftest.py fixtures over custom fixtures. This promotes consistency across the test suite and reduces duplication. The conftest.py at tests/conftest.py provides db, user_mgmt, event_mgmt, workflow, sample_user, admin_user, sample_event, and multiple_users fixtures automatically to all test files in tests/ and subdirectories like tests/unit/.","created_at":"2026-01-02T11:15:57.530Z","tags":"pytest,testing,fixtures,conftest,best-practices"}
{"id":"mem-b11cb6b136c5f368","information":"When adding a \"Copy Raw\" button alongside existing copy functionality in React components: (1) Create separate state for the new button's feedback (e.g., copiedRaw alongside copied), (2) Create a new handler function that preserves all data instead of stripping it (e.g., don't use regex to remove base64 images), (3) Use a different icon to differentiate (e.g., FileCode vs Copy from lucide-react), (4) Provide clear tooltip text explaining the difference. This pattern allows users to copy both formatted (for readability) and raw (for debugging) versions of logs.","created_at":"2026-01-03T22:39:15.959Z","tags":"react,clipboard,ui-pattern,debugging,copy-functionality"}
{"id":"mem-b2b9bb72b7ddf490","information":"Bug fix for ThinkingOverlay visibility: The previous implementation had thinkingStatus not clearing properly because the Konva-based overlay couldn't properly sync with React state. Solution: Move to pure HTML/CSS overlay positioned absolutely in parent component, check status !== 'idle' for visibility, return null when idle. This ensures proper cleanup and visibility control.","created_at":"2026-01-04T00:11:41.775Z","tags":"bug-fix,react,konva,overlay,visibility,state-management,thinking-status"}
{"id":"mem-bee513a5570da941","information":"Successfully moved 4 unit test files (test_database_sqlalchemy.py, test_family_management.py, test_permissions.py, test_authentication.py) from tests/ to tests/unit/ directory. After moving, pytest --collect-only verified all 211 tests can still be discovered and collected. The root conftest.py automatically provides fixtures to the subdirectory, so no test code modifications were needed.","created_at":"2026-01-02T11:20:08.802Z","tags":"pytest,directory-structure,unit-tests,file-organization"}
{"id":"mem-ca00cc765242b4ad","information":"Consolidated 4 separate test_clean_api*.py files (3,944 total lines) into 2 organized files: tests/unit/test_clean_api.py (core CRUD + permissions + security + workflows with mocks) and tests/integration/test_clean_api_database.py (real DB persistence tests). This improves maintainability by grouping unit tests (mock-based) vs integration tests (real DB). 42/46 tests pass; 4 failures are pre-existing mock configuration issues, not regressions from consolidation.","created_at":"2026-01-02T11:17:29.798Z","tags":"testing,refactoring,clean_api,pytest,test-organization"}
{"id":"mem-d8b6cae55f4633bb","information":"Fixed 9 failing tests in test_deletion_endpoints.py by:\n1. Replacing event_mgmt.update_invitation() calls with event_mgmt.update_rsvp(invitation_id, status=AttendanceStatus.CONFIRMED, guest_count=3)\n2. Fixing get_invitations_for_event() return format checks - it returns a dict with 'data' key, not a list. Use invitations[\"data\"][\"total\"] instead of len(invitations)\n3. Using different event dates to avoid unique constraint violations when creating multiple events\n4. Fixing invitation status field name from 'attendance_status' to 'status' in remove_invitation_by_id()\n5. Fixing family dissolution logic - family_dissolved should be True when remaining_count == 0 (no connections left)\n6. Handling events that are deleted by database cascade instead of just cancelled - checking for Error status or cancelled status\n7. Using db.get_invitations_by_user(user_id) to count invitations for a user in delete_user_with_cascade()\n8. Checking family state from remaining member's perspective after deletion since the base user is deleted\n9. Adding AttendanceStatus import to test file imports","created_at":"2026-01-02T11:56:28.811Z","tags":"testing,deletion-endpoints,api-server,bug-fixes,shabbat-server"}
{"id":"mem-e73cd90dc00b51fb","information":"CSS animation pattern for status overlays: Use separate @keyframes for different states (thinking-pulse, accepted-flash, rejected-flash), apply them via className changes in React useEffect, set setTimeout to clear animation classes after they complete (e.g., 600ms for flash animations). For continuous animations like pulsing, use infinite iteration. For one-time animations like flashes, calculate timing based on animation duration.","created_at":"2026-01-03T23:55:03.504Z","tags":"css,animation,keyframes,react,status-overlay,visual-feedback"}
{"id":"mem-efd8ee8989003b75","information":"When consolidating pytest test files, prefer the one that uses shared fixtures from conftest.py over files with their own local fixtures. Shared fixtures provide consistency across tests and reduce duplication. When merging test files, watch for hardcoded dates in tests - use date.today() + timedelta() for future dates instead of static dates that will become invalid over time.","created_at":"2026-01-02T11:16:12.761Z","tags":"pytest,testing,consolidation,fixtures,best-practices"}
{"id":"mem-efe4f6e6e49fedc5","information":"Fixed ModuleNotFoundError for 'fastapi' in test_clean_api_endpoints.py by adding fastapi>=0.104.0 to requirements.txt. The test file creates its own FastAPI app for integration testing REST endpoints (different from test_clean_api.py which tests business logic directly). Moved the file to tests/integration/ since it's an API integration test. FastMCP (fastmcp) is different from FastAPI - the project uses FastMCP for MCP server but the test needed plain FastAPI for testing.","created_at":"2026-01-02T11:02:14.439Z","tags":"fastapi,testing,integration-tests,dependencies,module-error"}
{"id":"mem-f52fc79ec5279d0d","information":"Canvas overlay integration pattern for image-markup-app: (1) Konva-based visual overlays (like ThinkingOverlay) go in DrawingLayer.tsx after other overlays like ResultOverlay, (2) HTML-based label overlays (like ThinkingOverlayLabel) go in WorkspaceCanvas.tsx after the Stage closing tag, alongside other HTML overlays like CoordinateMarker and DragPreview, (3) Both components need useAIProgress() hook to access shared state (thinkingImage, thinkingStatus), (4) Import ThinkingOverlay and ThinkingOverlayLabel from '@/components/GenerativeFill/ThinkingOverlay', (5) The label visibility is controlled by checking status !== 'idle'.","created_at":"2026-01-04T00:00:26.692Z","tags":"react,konva,canvas,overlay,integration,image-markup-app,ai-progress"}
{"id":"mem-fa9c99abe9708674","information":"When reorganizing pytest test directories, the root conftest.py at tests/conftest.py automatically provides fixtures to subdirectories like tests/unit/ and tests/integration/ due to pytest's parent directory fixture discovery. Update pytest.ini testpaths to include both subdirectories: 'testpaths = tests tests/unit tests/integration'. Create __init__.py files in both subdirs to mark them as packages.","created_at":"2026-01-02T10:56:01.261Z","tags":"pytest,testing,directory-structure,conftest,fixtures"}